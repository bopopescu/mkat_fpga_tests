# NB: section names are case sensitive, but option names are NOT!

# Configuration for automated testing using the 16 roaches dedicated
# for the purpose.

# All data network configuration is done using DHCP. The control
# computer (dbelab04) has a statically assigned data IP address
# (10.100.201.1). It has a 40 GBit inteface that currently has a 4x10GB
# breakout, but due to the network card limitations only one of them are
# active. This is currently plugged into a 10 Gb port along with the
# roaches. Now that we are using L3 we should be able to move it to a
# 40Gbit port, but the server's DHCP allocations is done statically on
# the basis of the physical swith port dhcp might have to be munged if
# we plug it into a 40gbit port.


# roaches   - top to bottom
#
#
###
# top-16, connected to top data switch:
##
# rack no -  Roach       - No ports
# 38      - roach02095B - 4 ports  -- F
# 37      - roach02095C - 4 ports  -- F
# 36      - roach020944 - 4 ports  -- F
# 35      - roach020921 - 4 ports  -- Unused
# 34      - roach02091E - 4 ports  -- X
# 33 -- removed, previously: - roach020A05 - 4 ports  -- (QDR errors, swapped with 20921)
# 33      - roach020A01 -- 4 ports -- X new (Andrews D-Eng)
# 32      - roach020959 - 4 ports  -- D  (QDR errors, QDR not used by D)
# 31      - roach020958 - 4 ports  -- F
# 30      - Brush panel
# 29      - + top data switch
# 28      - roach020A0A - 2 ports   -- X
# 27      - roach020A0C - 2 ports   -- X
# 26      - roach020937 - 2 ports   -- X
# 25      - roach020936 - 2 ports   -- X
# 24      - roach020948 - 2 ports   -- Unused (gbe0 dhcp tap)
# 23      - roach02092E - 2 ports   -- X
# 22      - roach020951 - 2 ports   -- X
# 21      - roach020950 - 2 ports   --  (Gbe2 dhcp tap errors)

# 20      - empty


[FxCorrelator]
katcp_port = 7147
sample_rate_hz = 1714304392
#sample_rate_hz = 1712000000
# Number of bits used in the F engine for timekeeping (the master counter)
timestamp_bits = 48
# mcnt_bits = 48
# Number of bits used in the packet header for timestamping
# pcnt_bits = 48
# How long should we wait for ARP resolution?
arp_wait_time = 2
# Rate at which FPGA registers are polled to update sensors
sensor_poll_time = 1
# Version of IGMP protocol to force on the engines
igmp_version = 2
time_jitter_allowed_ms = 500
time_offset_allowed_s = 5

[fengine]
# Need to have 4 ports
# Hardcoding roaches for now as some have dhcp port errors when used as either x/f engines
#hosts = ROACH0,ROACH1,ROACH2,ROACH3
#hosts = roach020958,roach020938,roach020927,roach020A0F
hosts = roach020944,roach02091F,roach020927,roach020915

#bitstream = /srv/mkat_fpga/bitstreams/feng_wide/r2_c856m32k.fpg
bitstream = /usr/local/lib/cmc/bitstreams/feng_wide/r2_c856m32k.fpg

# names and IPs of the sources to the f-engines
n_antennas = 4
# Number of f-engines per host - the PFB does two-pols, so only one, but it is two f-engines/pols
f_per_fpga = 2
# names to give the source polarisations - these must map to the IPs
#source_names = m000_x,m000_y,m001_x,m001_y,m002_x,m002_y,m003_x,m003_y
source_names = ant0_x,ant0_y,ant1_x,ant1_y,ant2_x,ant2_y,ant3_x,ant3_y
# my fake digitiser (D-engine), only two inputs so repeat four times to emulate four antennas
source_mcast_ips = INPUT0,INPUT1,INPUT2,INPUT3,INPUT4,INPUT5,INPUT6,INPUT7
# where should the f-data go?
destination_mcast_ips = 239.2.1.150+16:8888
# number of 10gbe ports per f-engine
ports_per_fengine = 2
# how many bits per ADC sample
sample_bits = 10
# how many parallel ADC samples do we get per digitiser clock?
adc_demux_factor = 8
# The processed analogue bandwidth
bandwidth = 857152196
#bandwidth = 856000000
# the centre frequency on the sky
true_cf = 1284000000
# Number of channels produced by the f-engine
n_chans = 32768
# FFT shifting schedule in decimal. A binary '1' shifts, a zero does not.
fft_shift = 2032
#fft_shift = 8191
# The fixed-point format post FFT in the F engines
quant_format = 8.7
# Packet length of 10Gbe exchange data in 64 bit words.
10gbe_pkt_len = 128

# MAC, IP and port for 10Gbe cores
10gbe_start_mac = 02:02:00:00:02:10
10gbe_start_ip = 10.101.0.200
10gbe_port = 8888

# SPEAD flavour, string in the form XX,YY. Default: 64,48. See the SPEAD documentation for details.
spead_flavour = 64,48
# Equalisation settings - one per input - must have the same suffix as the source names above
eq_poly_ant0_x = 50
eq_poly_ant0_y = 50
eq_poly_ant1_x = 50
eq_poly_ant1_y = 50
eq_poly_ant2_x = 50
eq_poly_ant2_y = 50
eq_poly_ant3_x = 50
eq_poly_ant3_y = 50
## Delay settings
min_load_time = 0.1
network_latency_adjust = 0

[xengine]
# Hardcoding roaches for now as some have dhcp port errors when used as either x/f engines

#hosts = roach020A0D,roach02091F,roach020915,roach020944
hosts = roach020938,roach020A0F,roach020A0D,roach020958

bitstream = /srv/mkat_fpga/bitstreams/xeng_wide/r2_4a4x2kf.fpg
#bitstream = /srv/bofs/xeng/r2_c4a4x2kf_2016_May_13_1409.fpg

# x fpga clock speed
x_fpga_clock = 230000000
# Number of X engines per host
x_per_fpga = 4
# Number of spectra to integrate in QDR
accumulation_len = 816
# Number of accumulations performed in the X engine cores
xeng_accumulation_len = 256
# Number of bits the vacc uses to represent one number
xeng_outbits = 32
# MAC, IP and port for 10Gbe cores
10gbe_start_mac = 02:02:00:00:20:10
10gbe_start_ip = 10.101.0.80
10gbe_port = 8888
# data product names and destinations
output_products = c856M4k
#output_destination_ip = 239.2.1.100
output_destination_ip = 10.100.1.1
output_destination_port = 8888
# what is the outgoing interface address? i.e. the eth interface that will send the meta information
multicast_interface_address = 127.0.0.1
# Packet length of 10Gbe exchange data in 64 bit words.
10gbe_pkt_len = 512

[dsimengine]
sample_rate_hz = 1714304392
#sample_rate_hz = 1712000000
bitstream = /srv/mkat_fpga/bitstreams/deng/r2_deng_tvg_rev1_13.fpg
host = dsim020959
#host = roach02095C
10gbe_start_mac = 02:02:00:00:50:01
10gbe_start_ip = 10.101.0.40
10gbe_port = 8888
pol0_destination_start_ip = 239.10.1.64
pol1_destination_start_ip = 239.10.1.66
# pol1_destination_start_ip = 10.101.0.2
# pol1_single_destination = 1
